"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class RouterRequest{constructor(){this.getURI=()=>("#/"===location.hash.substr(0,2)&&(this.URI=location.hash.substr(1)),this.URI),this.setURI=a=>{location.hash=a},this.URI="/"+location.hash}}class leafeon extends RouterRequest{constructor(){super(),this.getCurrentURI=()=>this.getURI(),this.setErrorCallback=a=>{this.notFoundCallback=a},this.notFoundException=()=>{this.notFoundCallback.apply(null,[])},this.before=(a,b)=>{this.BeforeRouteMiddleware=a,this.BeforeRouteMiddlewareFunc=b},this.map=(a,b,c=[])=>{c.forEach(c=>{this.add(a+c.name,b+this.FormatPath(c.path,!0),c.callback)})},this.fetchRoute=(a,b)=>{const c=this.routes.find(b=>b.name===a||b.path===a);if(!c.paramsEnabled)return void this.setURI(c.path);b||this.Exception("Error: route \""+a+"\" requires some parameters. None specified.");let d=this.GenerateURL(c.path,b);this.setURI(d)},this.GenerateURL=(a,b)=>{let c=a;for(let d in b){if(!b.hasOwnProperty(d))continue;const e=a.split("/").find(a=>a===":"+d);c=c.replace(e,b[d])}return c},this.FormatPath=(a,b=!1)=>(b&&"/"===a?a="":!b&&"/"===a.substr(0,1)&&(a=a.substr(1)),a),this.setRoute=(a,b=[])=>{this.route=a,this.routeCall=a.callback,this.params=b,this.notfound=!1},this.handle=a=>{const b=this.getCurrentURI();a.forEach(a=>{const c=a.split("/");let d=b.split("/");if(d.length!==c.length)return;const e=this.handlingParams(a),f=d.join("");e.RouteString!==f||this.routes.forEach(b=>{b.path===a&&this.notfound&&this.setRoute(b,e.params)})})},this.run=a=>{const b=this.getCurrentURI();let c=[];this.notfound=!0,this.BeforeMiddleware(this.BeforeRouteMiddleware,this.BeforeRouteMiddlewareFunc),this.routes.forEach(a=>{a.paramsEnabled?(c.push(a.path),this.handle(c)):a.path===b&&this.setRoute(a)}),this.notfound?this.notFoundException():this.routeCall.apply(null,this.params),null==a?null!=this.AfterRouteCallback&&this.AfterRouteCallback.apply(null,[]):(this.AfterRouteCallback=a,this.AfterRouteCallback.apply(null,[]))},this.BeforeMiddleware=(a,b)=>{const c=this.getURI();switch(a.substr(0,2)){case"#/":a=a.substr(1);break;case"/#":a=a.substr(2);}null!=b&&("*"===a?b.apply(null,[]):a===c&&b.apply(null,[]))},this.handlingParams=a=>{const b=this.getCurrentURI().split("/"),c=a.split("/"),d=[];for(let e=0;e<c.length;e++)":"===c[e].substr(0,1)&&(""!==b[e]&&d.push(b[e]),c[e]=b[e]);return{params:d,RouteString:c.join("")}},this.Exception=a=>{throw new TypeError(a)},this.notfound=!1,this.routes=[],this.paramsEnabled=!1,this.params=[],this.BeforeRouteMiddleware="*",this.routeCall=()=>{},this.BeforeRouteMiddlewareFunc=()=>{},this.AfterRouteCallback=()=>{},this.route={},this.notFoundCallback=()=>{throw new TypeError("404 error.")}}add(a,b,c){const d=b.split("/");let e=!1,f=[];switch(d.forEach(function(a){":"===a.substr(0,1)&&(e=!0,f.push(a.substr(1,a.length)))}),this.paramsEnabled=e,b.substr(0,2)){case"#/":b=b.substr(1);break;case"/#":b=b.substr(2);}this.routes.push({name:a,path:b,callback:c,paramsEnabled:e,params:f})}}exports.default=leafeon,window.addEventListener("hashchange",()=>{this.run()});