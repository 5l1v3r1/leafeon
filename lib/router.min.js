var router=function(){var parent=this;this.request=new Request('');this.notfound;this.routes=[];this.paramsEnabled=!1;this.routeCall=function(){};this.params=[];this.getRequestMethod=function(){return parent.request.method}
var notFoundCallback=function(){throw new TypeError('Router.js : 404 error.')}
this.setErrorCallback=function(func){notFoundCallback=func}
this.getCurrentURI=function(){return location.hash}
this.add=function(route,callback){let routeArray=route.split('/');let paramsEnabled=!1;let params=[];routeArray.forEach(function(e){if(e.substr(0,1)==':'){paramsEnabled=parent.paramsEnabled=!0;params.push(e.substr(1,e.length))}});parent.routes.push({route:route,callback:callback,paramsEnabled:paramsEnabled,params:params})}
this.goto=function(route){}
var setRoute=function(callback,params=[]){parent.routeCall=callback;parent.params=params;parent.notfound=!1}
this.handle=function(routes){let URI=parent.getCurrentURI();routes.forEach(function(Route){let RouteArray=Route.split('/');let URIarray=URI.split('/');if(URIarray.length==RouteArray.length){RouteOptions=new handlingParams(Route);URIarray=URIarray.join('');if(RouteOptions.RouteArray==URIarray){parent.routes.forEach(function(route){if(route.route==Route&&parent.notfound){setRoute(route.callback,RouteOptions.params)}})}}})}
this.run=function(AfterRouteCallback=null){let URI=parent.getCurrentURI();let routes=[];parent.notfound=!0;parent.routes.forEach(function(route){if(route.paramsEnabled){routes.push(route.route);parent.handle(routes)}else if(route.route===URI){setRoute(route.callback)}});if(parent.notfound){notFoundCallback()}else{parent.routeCall.apply(null,parent.params)}
if(AfterRouteCallback!=null){AfterRouteCallback()}}
window.addEventListener('hashchange',function(){parent.run()})}
var handlingParams=function(route){let URIarray=router.getCurrentURI().split('/');let RouteArray=route.split('/');let params=[];let RouteOptions={};for(i=0;i<RouteArray.length;i++){if(RouteArray[i].substr(0,1)==':'){if(URIarray[i]!=''){params.push(URIarray[i]);RouteArray[i]=URIarray[i]}}}
RouteOptions={params:params,RouteArray:RouteArray.join('')};return RouteOptions}